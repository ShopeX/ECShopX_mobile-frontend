(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"640":function(e,t,n){},"760":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=n(346),o=n(344),a=n(3),c=n(4),i=n.n(c),u=n(735),s=n(416),p=n(405),l=n(6),f=n(17),h=(n(640),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}());function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(r,o){try{var a=t[r](o),c=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(c).then(function(e){step("next",e)},function(e){step("throw",e)});e(c)}("next")})}}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var d=function(e){function WxAuth(){var e,t,n,c,i=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WxAuth);for(var u=arguments.length,s=Array(u),p=0;p<u;p++)s[p]=arguments[p];return t=n=_possibleConstructorReturn(this,(e=WxAuth.__proto__||Object.getPrototypeOf(WxAuth)).call.apply(e,[this].concat(s))),n.state={"isAuthShow":!1},n.handleGetUserInfo=(c=_asyncToGenerator(regeneratorRuntime.mark(function _callee(e){var t,c,u,s,p,h,d,b,w,y,v,m,_;return regeneratorRuntime.wrap(function _callee$(i){for(;;)switch(i.prev=i.next){case 0:if(t=e.detail,c=t.iv,u=t.encryptedData,s=t.rawData,p=t.signature,h=t.userInfo,c&&u){i.next=5;break}return Object(r.c)({"title":"授权提示","content":"ecshopx需要您的授权才能正常运行","showCancel":!1,"confirmText":"知道啦"}),i.abrupt("return");case 5:return i.next=7,Object(o.g)();case 7:return d=i.sent,b=d.code,Object(r.b)({"mask":!0,"title":"正在加载..."}),i.prev=10,i.next=13,l.a.wx.prelogin({"code":b,"iv":c,"encryptedData":u,"rawData":s,"signature":p,"userInfo":h});case 13:if(w=i.sent,y=w.token,v=w.open_id,m=w.union_id,_=w.user_id,f.a.setAuthToken(y),!_){i.next=23;break}return i.next=22,n.autoLogin();case 22:return i.abrupt("return");case 23:a.a.navigateTo({"url":"/pages/auth/reg?code="+b+"&open_id="+v+"&union_id="+m}),i.next=30;break;case 26:i.prev=26,i.t0=i.catch(10),console.info(i.t0),Object(r.d)({"title":"授权失败，请稍后再试","icon":"none"});case 30:Object(r.a)();case 31:case"end":return i.stop()}},_callee,i,[[10,26]])})),function(e){return c.apply(this,arguments)}),_possibleConstructorReturn(n,t)}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WxAuth,a["a"].Component),h(WxAuth,[{"key":"componentDidMount","value":function componentDidMount(){this.autoLogin()}},{"key":"autoLogin","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var e,t,n,r;return regeneratorRuntime.wrap(function _callee2$(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(o.g)();case 2:return e=a.sent,t=e.code,a.prev=4,a.next=7,l.a.wx.login({"code":t});case 7:if(n=a.sent,r=n.token){a.next=11;break}throw new Error("token is not defined: "+r);case 11:return f.a.setAuthToken(r),a.abrupt("return",this.redirect());case 15:a.prev=15,a.t0=a.catch(4),console.log(a.t0),this.setState({"isAuthShow":!0});case 19:case"end":return a.stop()}},_callee2,this,[[4,15]])}));return function autoLogin(){return e.apply(this,arguments)}}()},{"key":"redirect","value":function redirect(){var redirect=this.$router.params.redirect,e=redirect?decodeURIComponent(redirect):"/pages/member/index";a.a.redirectTo({"url":e})}},{"key":"render","value":function render(){var e=this.state.isAuthShow;return i.a.createElement(u.a,{"className":"page-wxauth"},e&&i.a.createElement(u.a,{"className":"sec-auth"},i.a.createElement(s.a,{"className":"auth-hint"},"需要您的授权才能继续"),i.a.createElement(p.a,{"type":"primary","lang":"zh_CN","openType":"getUserInfo","onGetUserInfo":this.handleGetUserInfo},"点此授权")))}},{"key":"componentDidShow","value":function componentDidShow(){}}]),WxAuth}()}}]);