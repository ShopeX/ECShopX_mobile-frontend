(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{"348":function(e,t,n){"use strict";n(4);var o=n(17),r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}(),a=function get(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:get(r,t,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0};function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(o,r){try{var a=t[o](r),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}var i={"WILL_MOUNT":0,"DID_MOUNT":1,"DID_SHOW":2};function withLogin(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.WILL_MOUNT;return void 0!==i[t]?(console.warn("lifeCycle is not in defined types: "+t),function(e){return e}):function withLoginComponent(e){return function(n){function WithLogin(e){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WithLogin),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WithLogin.__proto__||Object.getPrototypeOf(WithLogin)).call(this,e))}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WithLogin,e),r(WithLogin,[{"key":"componentWillMount","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var e;return regeneratorRuntime.wrap(function _callee$(n){for(;;)switch(n.prev=n.next){case 0:if(t!==i.WILL_MOUNT){n.next=9;break}return n.next=3,this.$__autoLogin();case 3:if(n.sent){n.next=6;break}return n.abrupt("return");case 6:a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentWillMount",this)&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentWillMount",this).call(this),n.next=13;break;case 9:return n.next=11,this.$__autoLoginDone();case 11:e=n.sent,a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentWillMount",this)&&e&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentWillMount",this).call(this);case 13:case"end":return n.stop()}},_callee,this)}));return function componentWillMount(){return e.apply(this,arguments)}}()},{"key":"componentDidMount","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var e;return regeneratorRuntime.wrap(function _callee2$(n){for(;;)switch(n.prev=n.next){case 0:if(t!==i.DID_MOUNT){n.next=9;break}return n.next=3,this.$__autoLogin();case 3:if(n.sent){n.next=6;break}return n.abrupt("return");case 6:a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidMount",this)&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidMount",this).call(this),n.next=13;break;case 9:return n.next=11,this.$__autoLoginDone();case 11:e=n.sent,a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidMount",this)&&e&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidMount",this).call(this);case 13:case"end":return n.stop()}},_callee2,this)}));return function componentDidMount(){return e.apply(this,arguments)}}()},{"key":"componentDidShow","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var e;return regeneratorRuntime.wrap(function _callee3$(n){for(;;)switch(n.prev=n.next){case 0:if(t!==i.DID_SHOW){n.next=9;break}return n.next=3,this.$__autoLogin();case 3:if(n.sent){n.next=6;break}return n.abrupt("return");case 6:a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidShow",this)&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidShow",this).call(this),n.next=13;break;case 9:return n.next=11,this.$__autoLoginDone();case 11:e=n.sent,a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidShow",this)&&e&&a(WithLogin.prototype.__proto__||Object.getPrototypeOf(WithLogin.prototype),"componentDidShow",this).call(this);case 13:case"end":return n.stop()}},_callee3,this)}));return function componentDidShow(){return e.apply(this,arguments)}}()},{"key":"$__autoLogin","value":function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var e;return regeneratorRuntime.wrap(function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return this.$__autoLogin_state="pending",e=void 0,t.prev=2,t.next=5,o.a.autoLogin(this);case 5:e=t.sent,this.$__autoLogin_state=e?"success":"fail",t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),this.$__autoLogin_state="fail";case 12:return t.abrupt("return",e);case 13:case"end":return t.stop()}},_callee4,this,[[2,9]])}));return function $__autoLogin(){return e.apply(this,arguments)}}()},{"key":"$__autoLoginDone","value":function $__autoLoginDone(){var e=void 0,t=8,n=this;return new Promise(function(o){!function next(){e&&clearTimeout(e),e=setTimeout(function(){var r=n.$__autoLogin_state;"success"===r||"fail"===r?(clearTimeout(e),e=null,o("success"===r)):t>0?(t--,next()):o(!1)},70)}()})}}]),WithLogin}()}}var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},s=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function withPager(e){var t,n;return t=function(t){function WithPagerComponent(e){!function withPager_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WithPagerComponent);var t=function withPager_possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WithPagerComponent.__proto__||Object.getPrototypeOf(WithPagerComponent)).call(this,e));n.call(t);var o=e||{},r=o.pageSize,a=void 0===r?10:r,i=o.pageNo,c=void 0===i?0:i,s=o.pageTotal,u={"hasNext":!0,"isLoading":!1,"total":void 0===s?0:s,"page_no":c,"page_size":a};return t.state.page=u,t}return function withPager_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WithPagerComponent,e),s(WithPagerComponent,[{"key":"resetPage","value":function resetPage(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=c({},this.state.page||{},{"page_no":0,"total":0,"isLoading":!1,"hasNext":!0});this.setState({"page":t},e)}}]),WithPagerComponent}(),n=function _initialiseProps(){var e=this;this.nextPage=function withPager_asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(o,r){try{var a=t[o](r),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function _callee(){var t,n,o,r,a,i;return regeneratorRuntime.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:if((t=e.state.page).hasNext&&!t.isLoading){s.next=3;break}return s.abrupt("return");case 3:return t.isLoading=!0,e.setState({"page":t}),n=t.page_no,o=t.page_size,r=n+1,s.next=9,e.fetch({"page_no":r,"page_size":o});case 9:a=s.sent,(!(i=a.total)||r>=Math.ceil(+i/o))&&(t.hasNext=!1),e.setState({"page":c({},t,{"total":i,"page_no":r,"isLoading":!1})});case 13:case"end":return s.stop()}},_callee,e)}))},t}var u=n(13),l=n(46),p=n.n(l),_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};function withBackToTop(e){return function(t){function WithBackToTopComponent(e){!function withBackToTop_classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WithBackToTopComponent);var t=function withBackToTop_possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WithBackToTopComponent.__proto__||Object.getPrototypeOf(WithBackToTopComponent)).call(this,e));return t.scrollBackToTop=function(){t.setState({"scrollTop":1},function(){})},t.handleScroll=p()(function(e){var n=e.detail,o=n.scrollTop;n.scrollHeight<600||(o>300&&!t.state.showBackToTop?(u.m.debug("[BackToTop] showBackToTop, scrollTop: "+o),t.setState({"showBackToTop":!0})):t.state.showBackToTop&&o<=300&&(u.m.debug("[BackToTop] hideBackToTop, scrollTop: "+o),t.setState({"showBackToTop":!1})))},70),t.state=_({},t.state,{"scrollTop":null,"showBackToTop":!1}),t}return function withBackToTop_inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WithBackToTopComponent,e),WithBackToTopComponent}()}n.d(t,"b",function(){return withLogin}),n.d(t,"c",function(){return withPager}),n.d(t,"a",function(){return withBackToTop})},"661":function(e,t,n){},"772":function(e,t,n){"use strict";n.r(t);var o,r=n(3),a=n(4),i=n.n(a),c=n(739),s=n(740),u=n(474),l=n(415),p=n(737),_=n(348),f=n(349),h=n(410),m=n(411),g=n(16),y=n(13),d=(n(661),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),b=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}t.default=Object(_.c)(o=Object(_.a)(o=function(e){function PointDrawOrder(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PointDrawOrder);var t=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(PointDrawOrder.__proto__||Object.getPrototypeOf(PointDrawOrder)).call(this,e));return t.handleClickItem=function(e){var t="/pages/member/point-draw-detail?luckydraw_id="+e.luckydraw_id+"&item_id="+e.item_id;r.a.navigateTo({"url":t})},t.handleClickTab=function(e){t.state.page.isLoading||(e!==t.state.curTabIdx&&(t.resetPage(),t.setState({"list":[]})),t.setState({"curTabIdx":e},function(){t.nextPage()}))},t.state=d({},t.state,{"curTabIdx":0,"tabList":[{"title":"进行中","status":"0"},{"title":"已揭晓","status":"1"}],"list":[],"listType":""}),t}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(PointDrawOrder,r["a"].Component),b(PointDrawOrder,[{"key":"componentDidMount","value":function componentDidMount(){var e=this,t=this.state.tabList.findIndex(function(e){return"0"===e.status});t>=0?this.setState({"curTabIdx":t},function(){e.nextPage()}):this.nextPage()}},{"key":"fetch","value":function(){var e=function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(o,r){try{var a=t[o](r),i=a.value}catch(e){return void n(e)}if(!a.done)return Promise.resolve(i).then(function(e){step("next",e)},function(e){step("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function _callee(e){var t,n,o,r,a,i,c;return regeneratorRuntime.wrap(function _callee$(s){for(;;)switch(s.prev=s.next){case 0:return t=this.state,n=t.tabList,o=t.curTabIdx,e=d({},e,{"is_lucky":n[o].status}),s.next=4,g.a.member.pointDrawPayList(e);case 4:return r=s.sent,a=r.list,i=r.total_count,(c=Object(y.q)(a,{"img":"item_pic","luckydraw_trade_id":"luckydraw_trade_id","title":"item_name","price":"luckydraw_point","lucky_open_time":function lucky_open_time(e){var t=e.lucky_open_time;return Object(y.f)(1e3*t,"YYYY-MM-DD HH:mm:ss")},"lucky_status":"lucky_status","luckydraw_id":"luckydraw_id","item_id":"item_id","sales_num":"sales_num","luckydraw_store":"luckydraw_store","mobile":"mobile","join_num":"join_num","is_own_lucky":"is_own_lucky","rate":function rate(e){var t=e.sales_num,n=e.luckydraw_store;return Number((t/n*100).toFixed(0))}})).map(function(e){"lucky"===e.lucky_status?e.lucky_status="中奖":"unlukcy"===e.lucky_status?e.lucky_status="未中奖":e.lucky_status="尚未开奖"}),this.setState({"list":[].concat(_toConsumableArray(this.state.list),_toConsumableArray(c))}),s.abrupt("return",{"total":i});case 11:case"end":return s.stop()}},_callee,this)}));return function fetch(t){return e.apply(this,arguments)}}()},{"key":"render","value":function render(){var e=this,t=this.state,n=t.list,o=t.listType,r=t.showBackToTop,a=t.scrollTop,_=t.page,g=t.curTabIdx,y=t.tabList;return i.a.createElement(c.a,{"className":"page-draworeder-list"},i.a.createElement(f.k,{"title":"抽奖信息","leftIconType":"chevron-left","fixed":"true"}),i.a.createElement(h.a,{"className":"trade-list__tabs","current":g,"tabList":y,"onClick":this.handleClickTab},y.map(function(e,t){return i.a.createElement(m.a,{"current":g,"key":t,"index":t})})),i.a.createElement(s.a,{"className":"goods-order__scroll","scrollY":!0,"scrollTop":a,"scrollWithAnimation":!0,"onScroll":this.handleScroll,"onScrollToLower":this.nextPage},i.a.createElement(c.a,{"className":"goods-list goods-list__type-"+o},n.map(function(t,n){return i.a.createElement(c.a,{"className":"goods-item","key":n,"onClick":e.handleClickItem.bind(e,t)},i.a.createElement(c.a,{"className":"goods-item__bd"},i.a.createElement(c.a,{"className":"goods-item__img-wrap"},i.a.createElement(u.a,{"className":"goods-item__img","mode":"aspectFill","src":t.img}),i.a.createElement(l.a,{"className":"goods-item__imgtext"},y[g].title)),i.a.createElement(c.a,{"className":"goods-item__cont"},i.a.createElement(l.a,{"className":"goods-item__title"},t.title),1===g?i.a.createElement(c.a,{"className":"goods-item__time-open"},i.a.createElement(l.a,null,"获得时间："),i.a.createElement(l.a,null,t.lucky_open_time)):i.a.createElement(c.a,{"className":"goods-item__time"},i.a.createElement(l.a,null,"本人已参与：",i.a.createElement(l.a,{"className":"number-color"},t.join_num),"次")),1===g?i.a.createElement(c.a,{"className":"goods-item__prices"},i.a.createElement(c.a,{"className":"goods-item__time"},i.a.createElement(l.a,null,"获得者：",t.mobile)),1===t.is_own_lucky&&i.a.createElement(c.a,{"className":"lucky-info"},t.lucky_status)):i.a.createElement(c.a,null,i.a.createElement(c.a,{"className":"goods-item__prices_ing"},i.a.createElement(p.a,{"strokeWidth":5,"percent":t.rate,"activeColor":"#C40000"})),i.a.createElement(c.a,{"className":"goods-item__prices_ing"},i.a.createElement(c.a,{"className":"person-num"},i.a.createElement(l.a,{"className":"number-color"},t.sales_num),i.a.createElement(l.a,null,"已参与")),i.a.createElement(c.a,{"className":"person-num"},i.a.createElement(l.a,null,t.luckydraw_store),i.a.createElement(l.a,null,"总需人次")),i.a.createElement(c.a,{"className":"person-num"},i.a.createElement(l.a,null,t.luckydraw_store-t.sales_num),i.a.createElement(l.a,null,"剩余")))))))})),_.isLoading?i.a.createElement(f.j,null,"正在加载..."):null,!_.isLoading&&!_.hasNext&&!n.length&&i.a.createElement(f.r,{"img":"trades_empty.png"},"赶快去参与抽奖吧~")),i.a.createElement(f.b,{"show":r,"onClick":this.scrollBackToTop}))}},{"key":"componentDidShow","value":function componentDidShow(){}}]),PointDrawOrder}())||o)||o}}]);