"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _class,_class2,_temp2,_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_createClass=function(){function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_get=function e(t,n,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,a)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(a):void 0},_index=require("../../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../../hocs/index.js"),_index4=require("../../api/index.js"),_index5=_interopRequireDefault(_index4),_index6=require("../../utils/index.js"),_index7=require("../../spx/index.js"),_index8=_interopRequireDefault(_index7);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _asyncToGenerator(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,n){try{var a=s[e](n),i=a.value}catch(e){return void o(e)}if(!a.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var RecommendList=(0,_index3.withPager)(_class=(0,_index3.withBackToTop)((_temp2=_class2=function(e){function l(){var e,t,o,n,s=this;_classCallCheck(this,l);for(var a=arguments.length,i=Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=o=_possibleConstructorReturn(this,(e=l.__proto__||Object.getPrototypeOf(l)).call.apply(e,[this].concat(i)))).$usedState=["anonymousState__temp","loopArray0","loopArray1","multiIndex","areaList","showDrawer","columnList","scrollTop","list","page","showBackToTop","selectColumn","address","query","info"],o.handleClickItem=function(e){var t="/pages/recommend/detail?id="+e.item_id;_index2.default.navigateTo({url:t})},o.handleConfirm=function(e){o.setState({query:_extends({},o.state.query,{title:e})},function(){o.resetPage(),o.setState({list:[]},function(){o.nextPage()})})},o.handleClickFilter=function(){o.setState({showDrawer:!0})},o.handleClickParmas=function(t){var e=o.state,n=e.columnList,a=e.selectColumn;n.map(function(e){e.id===t?(e.isChooseColumn=!0,a=e):e.isChooseColumn=!1}),o.setState({columnList:n,selectColumn:a})},o.handleClickSearchParams=function(e){if(o.setState({showDrawer:!1}),"reset"===e){var t=o.state,n=t.paramsList,a=t.selectParams;o.state.paramsList.map(function(e){e.attribute_values.map(function(e){""===e.attribute_value_id?e.isChooseParams=!0:e.isChooseParams=!1})}),a.map(function(e){e.attribute_value_id=""}),o.setState({paramsList:n,selectParams:a})}o.resetPage(),o.setState({list:[]},function(){o.nextPage()})},o.handleClickPicker=function(){var n=[],a=[],i=[];o.addList&&(o.addList.map(function(e,t){n.push(e.label),0===t&&e.children.map(function(e,t){a.push(e.label),0===t&&e.children.map(function(e){i.push(e.label)})})}),o.setState({showDrawer:!1,areaList:[n,a,i],multiIndex:[0,0,0]}))},o.bindMultiPickerChange=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var a,t,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=o.state.info,o.addList.map(function(e,t){t===n.detail.value[0]&&(a.province=e.label,e.children.map(function(e,t){t===n.detail.value[1]&&(a.city=e.label,e.children.map(function(e,t){t===n.detail.value[2]&&(a.county=e.label)}))}))}),t=a.province,i=a.city,r=a.area,o.setState({query:_extends({},o.state.query,{province:t,city:i,area:r})},function(){o.resetPage(),o.setState({list:[]},function(){o.nextPage()})}),o.setState({info:a});case 5:case"end":return e.stop()}},e,s)})),function(e){return n.apply(this,arguments)}),o.bindMultiPickerColumnChange=function(i){var e=o.state,r=e.areaList,t=e.multiIndex;0===i.detail.column?(o.setState({multiIndex:[i.detail.value,0,0]}),o.addList.map(function(e,t){if(t===i.detail.value){var n=[],a=[];e.children.map(function(e,t){n.push(e.label),0===t&&e.children.map(function(e){a.push(e.label)})}),r[1]=n,r[2]=a,o.setState({areaList:r})}})):1===i.detail.column?(t[1]=i.detail.value,t[2]=0,o.setState({multiIndex:t},function(){o.addList[t[0]].children.map(function(e,t){if(t===i.detail.value){var n=[];e.children.map(function(e){n.push(e.label)}),r[2]=n,o.setState({areaList:r})}})})):(t[2]=i.detail.value,o.setState({multiIndex:t}))},o.anonymousFunc0Array=[],o.$$refs=[],_possibleConstructorReturn(o,t)}var t;return _inherits(l,_index.Component),_createClass(l,[{key:"_constructor",value:function(e){_get(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"_constructor",this).call(this,e),this.state=_extends({},this.state,{list:[],query:null,showDrawer:!1,selectColumn:{},columnList:[],info:{},areaList:[],multiIndex:[]})}},{key:"componentDidShow",value:function(){var e=this;_index2.default.showLoading(),this.resetPage(),this.setState({list:[]}),setTimeout(function(){e.nextPage(),_index2.default.hideLoading()},200)}},{key:"fetch",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,a,i,r,o,s,l,u,c,d,p,f,m,_,h,y,x,g,v,b,C;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.page_no,a=t.page_size,i=this.state,r=i.columnList,o=i.areaList,s=this.state.selectColumn,l=_extends({},this.state.query,{article_type:"bring",page:n,pageSize:a,category_id:s.id}),0===r.length)return e.next=7,_index5.default.article.columnList();e.next=13;break;case 7:u=e.sent,c=(0,_index6.pickBy)(u,{name:"category_name",id:"category_id"}),d={id:"",name:"全部",isChooseColumn:!0},s=Object.assign({},d),c.unshift(d),this.setState({columnList:c});case 13:if(_index8.default.getAuthToken())return e.next=16,_index5.default.article.authList(l);e.next=19;break;case 16:e.t0=e.sent,e.next=22;break;case 19:return e.next=21,_index5.default.article.list(l);case 21:e.t0=e.sent;case 22:if(p=e.t0,f=p.list,m=p.total_count,_=p.province_list,0===o.length)return e.next=29,_index5.default.member.areaList();e.next=39;break;case 29:h=e.sent,y=[],_.map(function(t){var e=h.find(function(e){return t==e.id});e&&y.push(e)}),x=(0,_index6.pickBy)(y,{label:"label",id:"id",children:"children"}),this.addList=x,g=[],v=[],b=[],x.map(function(e,t){g.push(e.label),0===t&&e.children.map(function(e,t){v.push(e.label),0===t&&e.children.map(function(e){b.push(e.label)})})}),this.setState({areaList:[g,v,b]});case 39:return(C=(0,_index6.pickBy)(f,{img:"image_url",item_id:"article_id",title:"title",author:"author",summary:"summary",head_portrait:"head_portrait",isPraise:"isPraise",articlePraiseNum:"articlePraiseNum.count"})).map(function(e){e.articlePraiseNum||(e.articlePraiseNum=0)}),this.setState({list:[].concat(_toConsumableArray(this.state.list),_toConsumableArray(C))}),e.abrupt("return",{total:m});case 43:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"_createData",value:function(){var n=this;this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};arguments[2];var e=this.__state,t=e.list,a=e.showBackToTop,i=e.scrollTop,r=e.page,o=(e.showDrawer,e.info),s=e.columnList,l=(e.selectColumn,e.multiIndex,e.areaList,o.province+o.city),u=""+_index2.default.pxTransform(570),c=s.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},{$loopState__temp3:(0,_index6.classNames)("drawer-item__options__item",e.$original.isChooseColumn?"drawer-item__options__checked":""),$original:e.$original}}),d=t.map(function(e,t){return e={$original:(0,_index.internal_get_original)(e)},n.anonymousFunc0Array[t]=function(){return n.handleClickItem(e.$original)},{$original:e.$original}});return Object.assign(this.__state,{anonymousState__temp:u,loopArray0:c,loopArray1:d,scrollTop:i,page:r,showBackToTop:a,address:l}),this.__state}},{key:"anonymousFunc0",value:function(e,t){this.anonymousFunc0Array[e]&&this.anonymousFunc0Array[e](t)}}]),l}(),_class2.properties={},_class2.$$events=["handleConfirm","handleClickFilter","handleClickPicker","bindMultiPickerChange","bindMultiPickerColumnChange","handleClickParmas","handleClickSearchParams","handleScroll","nextPage","anonymousFunc0","scrollBackToTop"],_class2.config={navigationBarTitleText:"种草"},_class=_temp2))||_class)||_class;exports.default=RecommendList,Component(require("../../npm/@tarojs/taro-weapp/index.js").default.createComponent(RecommendList,!0));