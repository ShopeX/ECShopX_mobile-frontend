"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var entryLaunch=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,a,i,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,(n=t.scene?parseUrlStr(decodeURIComponent(t.scene)):t).dtid||(a=_index2.default.getStorageSync("curStore"),(i=a.distributor_id)&&(n.dtid=i)),u=!1,o={},n.dtid)return e.next=8,handleDistributorId(n.dtid);e.next=10;break;case 8:o=e.sent,u=!o.status;case 10:if(console.log("是否需要定位",u),u){e.next=16;break}return console.log("进行定位处理"),e.next=15,getLocal(r);case 15:o=e.sent;case 16:return console.log("定位或返回值",o),o.status||(n.store=o,n.dtid=o.distributor_id),n.uid?(_index2.default.setStorageSync("distribution_shop_id",n.uid),_index2.default.setStorageSync("trackParams",{})):n.s&&n.m&&(_index2.default.setStorageSync("distribution_shop_id",""),_index2.default.setStorageSync("trackParams",{source_id:n.s,monitor_id:n.m}),trackViewNum(n.m,n.s)),console.log("接收出来后参数",n),e.abrupt("return",n);case 21:case"end":return e.stop()}},e,this)}));return function(e,t){return r.apply(this,arguments)}}(),getLocalSetting=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={template_name:"yykweishop",version:"v1.0.1",name:"setting"},e.next=3,_index4.default.category.getCategory(t);case 3:if(r=e.sent,n=r[0].params,!(0<r.length)){e.next=17;break}if(n&&n.config){e.next=10;break}return e.abrupt("return",!0);case 10:if(n.config.location)return e.abrupt("return",!0);e.next=14;break;case 14:return e.abrupt("return",!1);case 15:e.next=18;break;case 17:return e.abrupt("return",!0);case 18:return e.abrupt("return",positionStatus);case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),getLocal=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,i,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getLocalSetting();case 2:if(r=e.sent,n=null,r){e.next=10;break}return e.next=7,_index4.default.shop.getShop();case 7:n=e.sent,e.next=28;break;case 10:if(a=_index2.default.getStorageSync("lnglat"))return i={},t&&r&&(i.lat=a.latitude,i.lng=a.longitude),e.next=16,_index4.default.shop.getShop(i);e.next=19;break;case 16:n=e.sent,e.next=28;break;case 19:return e.next=21,getLoc();case 21:if(""!==(u=e.sent))return o={},t&&r&&(o.lat=u.latitude,o.lng=u.longitude),e.next=27,_index4.default.shop.getShop(o);e.next=28;break;case 27:n=e.sent;case 28:return n.status?_index2.default.setStorageSync("curStore",!1):_index2.default.setStorageSync("curStore",n),e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),getLoc=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_index2.default.getLocation({type:"gcj02"}).then(function(e){return _index2.default.setStorage({key:"lnglat",data:e}),e},function(e){return""});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),_index=require("../npm/@tarojs/taro-weapp/index.js"),_index2=_interopRequireDefault(_index),_index3=require("../api/index.js"),_index4=_interopRequireDefault(_index3);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var o=e.apply(this,arguments);return new Promise(function(i,u){return function t(e,r){try{var n=o[e](r),a=n.value}catch(e){return void u(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});i(a)}("next")})}}function trackViewNum(e,t){if(!_index2.default.getStorageSync("_session"))return!0;if(e&&t){var r={source_id:t,monitor_id:e};_index4.default.track.viewnum(r)}return!0}function handleDistributorId(e){var t=_index4.default.shop.getShop({distributor_id:e});return!1===t.status?_index2.default.setStorageSync("trackIdentity",{distributor_id:e}):_index2.default.setStorageSync("trackIdentity",""),t}function parseUrlStr(e){var t=[];if(e)for(var r=0;r<e.split("&").length;r++)t[r]=e.split("&")[r];for(var n=[],a=0;a<t.length;a++){var i=t[a].split("=");n[i[0]]=decodeURI(i[1])}return n}exports.default={entryLaunch:entryLaunch,getLocal:getLocal};